<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETLC 동물 성격유형 검사</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #333;
        }
        .container {
            max-width: 800px;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .question-card {
            transition: opacity 0.5s ease-in-out;
        }
        .fade-out {
            opacity: 0;
            pointer-events: none;
        }
        .score-input:checked + .score-label {
            background-color: #6366f1;
            color: white;
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }
        .modal-content {
            z-index: 1001;
        }
        .hidden {
            display: none;
        }
        /* 각 동물 아이콘을 위한 스타일 */
        .animal-icon {
            font-size: 3rem; /* 아이콘 크기 */
        }
        .turtle-icon::after { content: '🐢'; }
        .chameleon-icon::after { content: '🦎'; }
        .lion-icon::after { content: '🦁'; }
        .eagle-icon::after { content: '🦅'; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="app" class="container mx-auto p-6 space-y-8">
        <!-- 단계별 화면이 여기에 표시됩니다 -->
    </div>

    <!-- 로딩 모달 -->
    <div id="loading-modal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl flex flex-col items-center modal-content">
            <svg class="animate-spin h-10 w-10 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-gray-700">결과를 분석 중입니다...</p>
        </div>
    </div>
    
    <script>
        // 전역 변수
        let currentStep = 0;
        let userAnswers = {}; // 사용자의 답변을 저장하는 객체
        let topCardChoice = '';
        let resultData = {};
        
        // 문항 데이터 (PDF 기반으로 재구성)
        const questions = [
            // E (독수리) 유형 관련 문항
            { id: 1, text: '어떤 일을 하기 전에 계획을 생각하는 편이다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 2, text: '다른 사람이 결정하도록 두기 보다 스스로 하는 것이 낫다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 3, text: '상황이 혼란스러운 것이 싫다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 4, text: '일이 꼼꼼하게 하는 것이 좋다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 5, text: '비난받을 때 대처하기가 힘들다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 6, text: '나는 예상치 못하는 상황이 싫다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 7, text: '나는 계획적인 사람이다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 8, text: '어떤 일을 하기 전에 먼저 꼼꼼히 생각해본다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 9, text: '무엇을 할 때 관계보다는 잘 하는 것이 중요하다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 10, text: '일을 시작하면 마무리할 때까지 참고 일한다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 11, text: '일을 완벽하게 처리하는 것을 중요하게 여긴다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 12, text: '⁂나는 비판을 받거나 조롱 당하는 것을 정말 싫어한다.', type: 'E', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 2, '약간 그렇다': 4, '매우 그렇다': 6 } },

            // T (거북이) 유형 관련 문항
            { id: 13, text: '자발적으로 내 일을 도와줄 때 매우 고맙다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 14, text: '결정하기 전에 충분히 고민한다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 15, text: '올바른 것을 결정하는 사람이 되고 싶다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 16, text: '스트레스를 받으면 주위 사람들에게 발끈한다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 17, text: '어떤 결정을 할 때 안전한지가 중요하다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 18, text: '쉬고 있는데 누군가 끼어들어 심각한 이야기를 하는 것이 싫다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 19, text: '하루 중 나만을 위한 여유 시간이나 장소가 필요하다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 20, text: '나는 빨리 하는 것보다 느리더라도 바르게 하는 것이 좋다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 21, text: '내가 잘하는 것을 다른 사람들에게 알려주는 것을 잘 한다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 22, text: '건강을 중요하게 생각한다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 23, text: '나는 다른 사람의 말을 잘 들어준다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 24, text: '⁂나는 내 속도대로 하는데 재촉해서 압박감을 느끼는 것이 정말 싫다.', type: 'T', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 2, '약간 그렇다': 4, '매우 그렇다': 6 } },

            // L (사자) 유형 관련 문항
            { id: 25, text: '내게 더 좋은 생각이 있을 때 말하지 않고 참는 것이 힘들다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 26, text: '사람들은 내게 존재감이 있다고 말한다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 2, '약간 그렇다': 1, '매우 그렇다': 3 } },
            { id: 27, text: '사람들이 나를 주목할 때 기분이 좋다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 3, '매우 그렇다': 2 } },
            { id: 28, text: '나는 스트레스를 받으면 논리적으로 해결하기 보다 힘으로 해결하고 싶다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 29, text: '나는 종종 계획 없이 너무 많은 약속을 한다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 30, text: '내가 사람들에게 영향력을 미칠 때 정말 좋다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 31, text: '약간의 위험이 있더라고 모험을 즐길 준비가 되어 있다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 32, text: '새로운 아이디어를 발표하는 것이 어렵지 않다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 33, text: '나는 사람들이 내 생각을 동의하지 않으면 내가 인정 받지 못한 느낌이 든다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 34, text: '어려운 일이라도 사람들이 원하면 하는 편인다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 35, text: '나는 언제나 내가 하는 일을 더 잘하고자 노력한다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 36, text: '⁂내가 의미 없거나 중요하지 않다고 느껴질 때 정말 싫다.', type: 'L', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 4, '약간 그렇다': 2, '매우 그렇다': 6 } },

            // C (카멜레온) 유형 관련 문항
            { id: 37, text: '친구를 위해서 때론 내가 불편한 건 기꺼이 참는다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 2, '약간 그렇다': 1, '매우 그렇다': 3 } },
            { id: 38, text: '나는 결정을 할 때 주변의 반응에 민감하다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 39, text: '사람들은 내가 배려를 많이 한다고 한다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 40, text: '때론 자신보다 소중한 사람들을 더 걱정하기도 한다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 41, text: '사람들에게 친근하게 대한다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 42, text: '다른 사람과 소소한 즐거움을 주고 받고 싶다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 43, text: '나는 주변 사람들과 마음을 나누는 것을 좋아한다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 44, text: '주변에 사소한 불편한 것들이 있을 때 신경이 계속 쓰이는 편이다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 45, text: '거절하기가 힘들어 ‘아니오’라고 해야 하는데 ‘네’라고 한다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 46, text: '나는 사람들과 정면으로 맞서는 게 매우 어렵다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 47, text: '나는 주변 사람들에게 관심이 많은 편이다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 1, '약간 그렇다': 2, '매우 그렇다': 3 } },
            { id: 48, text: '⁂혼자 남겨지거나 다른 사람의 기분을 상하게 하는 상황이 힘들다.', type: 'C', scores: { '매우 그렇지 않다': 0, '약간 그렇지 않다': 4, '약간 그렇다': 2, '매우 그렇다': 6 } },
        ];

        // 동물 유형별 상세 정보 (PPT, PDF 기반으로 재구성)
        const animalTypes = {
            'E': {
                name: '독수리',
                icon: 'eagle-icon',
                topCard: '비판과 조롱',
                description: '높은 곳에서 넓게 보는 시야를 가진 유형입니다. 이상적이고 완벽함을 추구하며 모든 것을 스스로 해결하려 합니다.',
                strengths: '많은 것을 이루어내고 주위를 즐겁게 한다. 자신이 원하는 것을 먼저 말할 수 있고 자신감이 있다. 우월성에 집착하지 않는다면 보다 깊이 있고 자존감을 가지게 된다.',
                weaknesses: '압도하려 하고 결국 지쳐버림. 다른 사람에게 무능력하거나 중요하지 않다는 감정을 불러일으킨다. 무례하게 보인다. 완벽하지 않는 사람들을 참아야 한다고 생각함.',
                growthTip: '비난을 멈추고 해결책을 찾는 것, 당신이 가지지 않은 것을 부러워 말고 당신이 가진 것을 바라볼 것. 다른 사람들에 관심을 갖고 그것에 대해 호기심을 가질 것. 산책, 운동, 건강한 음식 먹기를 통해 자신의 마음을 다독여보세요. 자신의 또는 학급 일과표를 만들어 보세요.',
            },
            'T': {
                name: '거북이',
                icon: 'turtle-icon',
                topCard: '고통과 스트레스',
                description: '느리지만 묵묵히 자신의 길을 가는 유형입니다. 문제 해결보다는 갈등을 피하고 싶어하는 경향이 있습니다.',
                strengths: '유연하고 사람들이 당신 주위에 있는 것을 즐긴다. 잘하는 것을 한다. 태평하다. 자신에게 필요한 것을 찾는다. 도움을 요청하고 다른 사람에게 편안함을 준다. 편안함에 집착하지 않는다면 용기 있고 품의를 유지할 수 있다.',
                weaknesses: '지루함. 게으름. 결과를 만드는 것에 취약. 동기를 불러일으키지 않음. 나누지 않음. 당신은 걱정하고 있지만 누구도 당신이 힘들어한다는 것을 모름.',
                growthTip: '자신의 또는 학급 일과표를 만들어라. 비록 창대하지 않더라도 자신이 한 것을 나누어라. 판단하고 단정하는 대신 당신이 원하는 것이나 다른 사람에 대해 질문하라. 자신의 재능을 주위에 발산하고, 다른 사람에게 도움을 요청하는 용기를 가지세요.',
            },
            'L': {
                name: '사자',
                icon: 'lion-icon',
                topCard: '의미 없음, 중요하지 않음',
                description: '강력한 힘과 리더십을 상징하는 유형입니다. 목표를 세우고 주도적으로 이끌어가는 능력이 뛰어납니다.',
                strengths: '좋은 리더로 위기를 극복한다. 적극적이고 꾸준하며 구조화에 능하다. 법을 준수하고 원하는 것을 얻는다. 결국 완수한다. 상황을 책임진다. 인내심을 가지고 기다린다.',
                weaknesses: '다른 사람이 더 잘할 수 있음에도 통제하려 한다. 존중, 협력, 충성을 얻고자 한다. 비난하기. 녹초가 되어 버림. 지나치게 한다. 불필요한 싸움을 한다.',
                growthTip: '모든 것을 책임져야 한다고 생각하지 않는 것. 생기지 않은 문제를 막기 위해 너무 애쓰지 말고 단계적으로 행동할 것. 물러나지 말고 경청할 것. 방어하지 말고 들으며, 도움을 요청하고 권한을 나누어 보세요.',
            },
            'C': {
                name: '카멜레온',
                icon: 'chameleon-icon',
                topCard: '거절과 귀찮음',
                description: '주변 환경에 맞춰 자신의 색을 바꾸는 유형입니다. 외부의 평가에 민감하며, 다른 사람의 기대에 맞춰 행동하려는 경향이 있습니다.',
                strengths: '친구가 많고 타인에 대해 sensitive하다. 타협에 능하고 사려 깊고 공격적이지 않다. 스스로 자청하며 사람들이 신뢰한다. 인정받으려 집착하지 않는다면 사랑을 주고 사랑받을 수 있다.',
                weaknesses: '거절을 힘들어 하며, 다른 사람들이 행복하지 않을 때 스스로의 책임이라고 생각하여 지치게 된다. 그러면 다른 사람들의 지지를 받으려 하고 갈등이 심해지면 관계를 피하거나 단절하려 한다.',
                growthTip: '더 열린 자세로 정직하고 당신의 생각과 감정을 말해라. 거절하고 그렇게 행동해라. 타인의 감정과 행동에 연연하지 마라. 당신의 재능을 주위에 발산하고, 당신의 속도대로 할 수 있도록 주위에 말하세요.',
            }
        };

        // UI 렌더링 함수
        function renderStep(step) {
            const app = document.getElementById('app');
            app.innerHTML = ''; // 기존 내용 삭제
            let content = '';

            // 1단계: 시작 및 Top 카드 선택
            if (step === 0) {
                content = `
                    <div class="card p-8 text-center space-y-6 animate-fade-in-down">
                        <h1 class="text-3xl font-bold text-gray-800">교사를 위한 자존감의 열쇠<br>ETLC 동물 성격유형 검사</h1>
                        <p class="text-gray-600 leading-relaxed">
                            이 검사는 교사 자신의 성격(Life Style)을 이해하고, 다양한 학생들을 효과적으로 훈육하고 소통하는 방법을 찾는 데 도움을 줍니다.<br>자신의 강점과 성장해야 할 부분을 발견하여 학생들과의 관계를 더욱 긍정적으로 만들어 보세요.
                        </p>
                        <div class="space-y-4">
                            <h2 class="text-xl font-bold mt-8">준비 활동: 피하고 싶은 상자 고르기</h2>
                            <p class="text-gray-500">
                                네 상자 중, 가장 피하고 싶은 상자는 무엇인가요?
                            </p>
                            <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                                <button onclick="selectTopCard('비판과 조롱')" class="card p-4 text-center btn-top-card ${topCardChoice === '비판과 조롱' ? 'bg-indigo-200 ring-2 ring-indigo-500' : ''}">
                                    <h3 class="font-bold text-lg">비판과 조롱</h3>
                                </button>
                                <button onclick="selectTopCard('고통과 스트레스')" class="card p-4 text-center btn-top-card ${topCardChoice === '고통과 스트레스' ? 'bg-indigo-200 ring-2 ring-indigo-500' : ''}">
                                    <h3 class="font-bold text-lg">고통과 스트레스</h3>
                                </button>
                                <button onclick="selectTopCard('의미 없음, 중요하지 않음')" class="card p-4 text-center btn-top-card ${topCardChoice === '의미 없음, 중요하지 않음' ? 'bg-indigo-200 ring-2 ring-indigo-500' : ''}">
                                    <h3 class="font-bold text-lg">의미 없음, 중요하지 않음</h3>
                                </button>
                                <button onclick="selectTopCard('거절과 귀찮음')" class="card p-4 text-center btn-top-card ${topCardChoice === '거절과 귀찮음' ? 'bg-indigo-200 ring-2 ring-indigo-500' : ''}">
                                    <h3 class="font-bold text-lg">거절과 귀찮음</h3>
                                </button>
                            </div>
                        </div>
                        <button id="start-btn" onclick="goToFirstQuestion()" class="btn-primary w-full max-w-xs mx-auto mt-8 ${topCardChoice ? '' : 'opacity-50 cursor-not-allowed'}" ${topCardChoice ? '' : 'disabled'}>ETLC 검사 시작하기</button>
                    </div>
                `;
            } 
            // 2단계: 검사 진행 (4문제씩 페이지 분할)
            else if (step > 0 && step <= questions.length / 4) {
                const startIndex = (step - 1) * 4;
                const pageQuestions = questions.slice(startIndex, startIndex + 4);
                
                content = `
                    <div class="card p-8 space-y-6 question-card">
                        <div class="text-center">
                            <p class="text-lg text-gray-500">페이지 ${step} / ${questions.length / 4}</p>
                            <h2 class="text-2xl font-bold mt-2 text-gray-800 leading-relaxed">아래 문항들을 읽고 솔직하게 답변해주세요.</h2>
                        </div>
                        <div class="space-y-8 mt-6">
                            ${pageQuestions.map(q => `
                                <div class="space-y-4">
                                    <h3 class="text-xl font-bold">${q.id}. ${q.text}</h3>
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                        ${Object.entries(q.scores).map(([label, value]) => `
                                            <input type="radio" id="q${q.id}-${value}" name="q${q.id}" value="${value}" class="score-input hidden" ${userAnswers[q.id] && userAnswers[q.id].score === value ? 'checked' : ''}>
                                            <label for="q${q.id}-${value}" class="score-label card text-center p-3 rounded-lg cursor-pointer transition-colors duration-200 border border-gray-200 hover:bg-gray-100 text-sm">
                                                ${label}
                                            </label>
                                        `).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex justify-between mt-8">
                            <button onclick="prevPage()" class="btn-primary ${step === 1 ? 'hidden' : ''}">이전</button>
                            <button onclick="nextPage()" class="btn-primary ml-auto">다음</button>
                        </div>
                    </div>
                `;
            }
            // 3단계: 결과 화면
            else if (step === questions.length / 4 + 1) {
                app.innerHTML = ' '; // Clear app content before rendering results
                showLoadingModal();
                calculateResults().then(() => {
                    hideLoadingModal();
                    content = `
                        <div id="result-page" class="card p-8 space-y-6 animate-fade-in">
                            <h1 class="text-3xl font-bold text-center text-gray-800">ETLC 검사 결과</h1>
                            
                            <!-- 결과 요약 -->
                            <div class="border-t border-b py-4 space-y-4">
                                <h2 class="text-xl font-bold">나의 성격(Life Style): <span class="text-indigo-600">${resultData.mainType.name}</span></h2>
                                <p class="text-gray-700">${resultData.mainType.description}</p>
                                <div class="flex items-center justify-center space-x-4 text-gray-600">
                                    <span class="text-5xl ${resultData.mainType.icon}"></span>
                                </div>
                            </div>
                            <div class="border-b py-4 space-y-4">
                                <h2 class="text-xl font-bold">나의 전략(Operate system): <span class="text-indigo-600">${resultData.subType.name}</span></h2>
                                <p class="text-gray-700">문제를 해결할 때 주로 사용하는 방식입니다.</p>
                                <div class="flex items-center justify-center space-x-4 text-gray-600">
                                    <span class="text-5xl ${resultData.subType.icon}"></span>
                                </div>
                            </div>
                            <div class="border-b py-4 space-y-4">
                                <h2 class="text-xl font-bold">내가 고른 상자와 결과의 연관성</h2>
                                <p class="text-gray-700">
                                    처음에 고른 상자는 당신의 내면적 동기와 연결되어 있습니다. 결과를 통해 확인해 보세요.
                                </p>
                                <p class="text-gray-700">
                                    <strong>내가 고른 상자:</strong> ${topCardChoice}
                                </p>
                                <p class="text-gray-700">
                                    <strong>관련 유형의 상자:</strong> ${resultData.mainType.topCard} (${resultData.mainType.name})
                                </p>
                                <p class="text-gray-700">
                                    <strong>분석:</strong> ${resultData.mainType.topCard === topCardChoice ? '당신이 가장 피하고 싶어하는 것은 당신의 핵심적인 동기와 연결되어 있습니다. 이 검사는 당신의 라이프스타일과 관련된 상황을 회피하려는 경향을 보여줍니다.' : '당신이 피하고 싶은 것은 당신의 보조적인 성향(전략)과 관련되어 있을 수 있습니다. 이는 평소에는 잘 드러나지 않지만, 스트레스 상황에서 나타나는 반응일 수 있습니다.'}
                                </p>
                            </div>
                            <div class="space-y-4">
                                <h2 class="text-2xl font-bold text-center text-gray-800 mt-8">ETLC 점수</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h3 class="font-bold text-lg">E (독수리)</h3>
                                        <p class="text-2xl font-bold text-indigo-600">${resultData.scores.E}</p>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h3 class="font-bold text-lg">T (거북이)</h3>
                                        <p class="text-2xl font-bold text-indigo-600">${resultData.scores.T}</p>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h3 class="font-bold text-lg">L (사자)</h3>
                                        <p class="text-2xl font-bold text-indigo-600">${resultData.scores.L}</p>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h3 class="font-bold text-lg">C (카멜레온)</h3>
                                        <p class="text-2xl font-bold text-indigo-600">${resultData.scores.C}</p>
                                    </div>
                                </div>
                                <p class="text-gray-700 mt-4">
                                    가장 높은 점수 **(${resultData.mainType.name})**가 당신의 기본적인 성격(Life Style)이며, 두 번째로 높은 점수 **(${resultData.subType.name})**가 문제를 해결할 때 주로 사용하는 전략입니다.
                                </p>
                            </div>

                            <!-- 상세 분석 -->
                            <div class="space-y-4" id="detailed-analysis">
                                <h2 class="text-2xl font-bold text-center text-gray-800 mt-8">상세 분석</h2>
                                <div class="bg-gray-50 p-6 rounded-lg space-y-4">
                                    <h3 class="text-lg font-bold">나의 강점 (활용해야 할 점)</h3>
                                    <p class="text-gray-700">${resultData.mainType.strengths}</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-lg space-y-4">
                                    <h3 class="text-lg font-bold">나의 약점 (업그레이드해야 할 점)</h3>
                                    <p class="text-gray-700">${resultData.mainType.weaknesses}</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-lg space-y-4">
                                    <h3 class="text-lg font-bold">성장을 위한 조언</h3>
                                    <p class="text-gray-700">${resultData.mainType.growthTip}</p>
                                </div>
                            </div>

                            <!-- 마무리 메시지 및 추가 활동 -->
                            <div class="space-y-4 mt-8">
                                <p class="text-center text-gray-700 font-bold">
                                    이 검사의 진정한 목적은 나를 알고, 다른 사람을 아는 것입니다. <br>나 자신과 학생들의 다름을 이해하고 존중할 때, 우리는 모두 함께 성장할 수 있습니다.
                                </p>
                            </div>
                            
                            <div class="flex flex-col items-center mt-8 space-y-4">
                                <button onclick="downloadPDF()" class="btn-primary w-full max-w-sm">내 결과 PDF로 다운받기</button>
                                <p class="text-gray-500 text-sm">모든 사람은 다릅니다. 이 검사를 통해 '나'를 이해하고, '학생'을 존중하며, 함께 성장하는 교육을 실천하는 데 한 걸음 더 나아가기를 바랍니다. 감사합니다.</p>
                            </div>
                        </div>
                    `;
                    app.innerHTML = content;
                });
            }

            if (content) {
                app.innerHTML = content;
            }
        }
        
        // Top 카드 선택 및 버튼 활성화
        function selectTopCard(choice) {
            topCardChoice = choice;
            const topCardButtons = document.querySelectorAll('.btn-top-card');
            topCardButtons.forEach(btn => btn.classList.remove('bg-indigo-200', 'ring-2', 'ring-indigo-500'));
            const selectedButton = Array.from(topCardButtons).find(btn => btn.innerText.includes(choice));
            if (selectedButton) {
                selectedButton.classList.add('bg-indigo-200', 'ring-2', 'ring-indigo-500');
            }
            document.getElementById('start-btn').disabled = false;
            document.getElementById('start-btn').classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // '시작하기' 버튼 클릭 시 첫 질문으로 이동
        function goToFirstQuestion() {
            currentStep = 1;
            renderStep(currentStep);
        }

        // 다음 페이지로 이동
        function nextPage() {
            // 현재 페이지의 모든 문항에 대한 답변 확인
            const startIndex = (currentStep - 1) * 4;
            const pageQuestions = questions.slice(startIndex, startIndex + 4);
            let allAnswered = true;
            pageQuestions.forEach(q => {
                const selectedValue = document.querySelector(`input[name="q${q.id}"]:checked`);
                if (!selectedValue) {
                    allAnswered = false;
                }
            });

            if (!allAnswered) {
                showModal('알림', '모든 문항에 답변해 주세요.');
                return;
            }

            // 현재 페이지의 답변을 userAnswers 객체에 저장
            pageQuestions.forEach(q => {
                const selectedValue = document.querySelector(`input[name="q${q.id}"]:checked`);
                const score = parseInt(selectedValue.value);
                userAnswers[q.id] = { score: score, type: q.type };
            });

            if (currentStep < questions.length / 4) {
                currentStep++;
                renderStep(currentStep);
            } else {
                currentStep++;
                renderStep(currentStep);
            }
        }
        
        // 이전 페이지로 이동
        function prevPage() {
            if (currentStep > 1) {
                currentStep--;
                renderStep(currentStep);
            } else if (currentStep === 1) {
                currentStep = 0; // 시작 화면으로 이동
                renderStep(currentStep);
            }
        }

        // 결과 계산 및 데이터 구성
        async function calculateResults() {
            let etlcScores = { E: 0, T: 0, L: 0, C: 0 };
            
            // userAnswers 객체에서 점수 총합 계산
            for (const key in userAnswers) {
                if (userAnswers.hasOwnProperty(key)) {
                    const answer = userAnswers[key];
                    etlcScores[answer.type] += answer.score;
                }
            }

            // 점수가 같은 경우, 마지막 문항 점수 비교
            const sortedScores = Object.entries(etlcScores).sort((a, b) => {
                if (b[1] !== a[1]) {
                    return b[1] - a[1];
                }
                const aLastQId = questions.find(q => q.type === a[0] && q.text.startsWith('⁂')).id;
                const bLastQId = questions.find(q => q.type === b[0] && q.text.startsWith('⁂')).id;
                
                const aLastScore = userAnswers[aLastQId] ? userAnswers[aLastQId].score : 0;
                const bLastScore = userAnswers[bLastQId] ? userAnswers[bLastQId].score : 0;
                
                return bLastScore - aLastScore;
            });
            
            const mainTypeChar = sortedScores[0][0];
            const subTypeChar = sortedScores[1][0];

            resultData = {
                mainType: animalTypes[mainTypeChar],
                subType: animalTypes[subTypeChar],
                scores: etlcScores,
            };
        }

        // PDF 다운로드 함수
        async function downloadPDF() {
            showLoadingModal();
            const element = document.getElementById('result-page');
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            
            html2canvas(element, { scale: 2 }).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg');
                const imgWidth = 550;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 20;
                
                doc.addImage(imgData, 'JPEG', 20, position, imgWidth, imgHeight);
                heightLeft -= (841.89 - 20); // A4 높이 - 마진
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight + 20;
                    doc.addPage();
                    doc.addImage(imgData, 'JPEG', 20, position, imgWidth, imgHeight);
                    heightLeft -= (841.89 - 20);
                }

                doc.save('ETLC_검사결과.pdf');
                hideLoadingModal();
            }).catch(error => {
                console.error('PDF 생성 중 오류 발생:', error);
                hideLoadingModal();
                showModal('오류', 'PDF 생성에 실패했습니다. 다시 시도해 주세요.');
            });
        }
        
        // 로딩 모달 표시/숨기기
        function showLoadingModal() {
            document.getElementById('loading-modal').classList.remove('hidden');
        }

        function hideLoadingModal() {
            document.getElementById('loading-modal').classList.add('hidden');
        }

        // 알림 모달
        function showModal(title, message) {
            const modalHtml = `
                <div id="alert-modal" class="fixed inset-0 flex items-center justify-center modal-overlay">
                    <div class="bg-white p-8 rounded-lg shadow-xl modal-content text-center">
                        <h3 class="text-xl font-bold mb-4">${title}</h3>
                        <p class="mb-6">${message}</p>
                        <button onclick="hideModal()" class="btn-primary">확인</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function hideModal() {
            const modal = document.getElementById('alert-modal');
            if (modal) {
                modal.remove();
            }
        }

        // 초기 화면 렌더링
        document.addEventListener('DOMContentLoaded', () => {
            renderStep(currentStep);
        });
    </script>
</body>
</html>
